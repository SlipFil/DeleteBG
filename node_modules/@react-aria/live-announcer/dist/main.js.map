{"mappings":"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","sources":["packages/@react-aria/live-announcer/src/index.ts","packages/@react-aria/live-announcer/src/LiveAnnouncer.tsx"],"sourcesContent":["/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nexport * from './LiveAnnouncer';\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport React, {Fragment, ReactNode, RefObject, useImperativeHandle, useState} from 'react';\nimport ReactDOM from 'react-dom';\nimport {VisuallyHidden} from '@react-aria/visually-hidden';\n\ntype Assertiveness = 'assertive' | 'polite';\ninterface Announcer {\n  announce(message: string, assertiveness: Assertiveness, timeout: number): void,\n  clear(assertiveness: Assertiveness): void\n}\n\n/* Inspired by https://github.com/AlmeroSteyn/react-aria-live */\nconst LIVEREGION_TIMEOUT_DELAY = 7000;\n\nlet liveRegionAnnouncer = React.createRef<Announcer>();\nlet node: HTMLElement = null;\nlet messageId = 0;\n\n/**\n * Announces the message using screen reader technology.\n */\nexport function announce(\n  message: string,\n  assertiveness: Assertiveness = 'assertive',\n  timeout = LIVEREGION_TIMEOUT_DELAY\n) {\n  ensureInstance(announcer => announcer.announce(message, assertiveness, timeout));\n}\n\n/**\n * Stops all queued announcements.\n */\nexport function clearAnnouncer(assertiveness: Assertiveness) {\n  ensureInstance(announcer => announcer.clear(assertiveness));\n}\n\n/**\n * Removes the announcer from the DOM.\n */\nexport function destroyAnnouncer() {\n  if (liveRegionAnnouncer.current) {\n    ReactDOM.unmountComponentAtNode(node);\n    document.body.removeChild(node);\n    node = null;\n  }\n}\n\n/**\n * Ensures we only have one instance of the announcer so that we don't have elements competing.\n */\nfunction ensureInstance(callback: (announcer: Announcer) => void) {\n  if (!liveRegionAnnouncer.current) {\n    node = document.createElement('div');\n    node.dataset.liveAnnouncer = 'true';\n    document.body.prepend(node);\n    ReactDOM.render(\n      <LiveRegionAnnouncer ref={liveRegionAnnouncer} />,\n      node,\n      () => callback(liveRegionAnnouncer.current)\n    );\n  } else {\n    callback(liveRegionAnnouncer.current);\n  }\n}\n\nconst LiveRegionAnnouncer = React.forwardRef((_, ref: RefObject<Announcer>) => {\n  let [assertiveMessages, setAssertiveMessages] = useState([]);\n  let [politeMessages, setPoliteMessages] = useState([]);\n\n  let clear = (assertiveness: Assertiveness) => {\n    if (!assertiveness || assertiveness === 'assertive') {\n      setAssertiveMessages([]);\n    }\n\n    if (!assertiveness || assertiveness === 'polite') {\n      setPoliteMessages([]);\n    }\n  };\n\n  let announce = (message: string, assertiveness = 'assertive', timeout = LIVEREGION_TIMEOUT_DELAY) => {\n    let id = messageId++;\n\n    if (assertiveness === 'assertive') {\n      setAssertiveMessages(messages => [...messages, {id, text: message}]);\n    } else {\n      setPoliteMessages(messages => [...messages, {id, text: message}]);\n    }\n\n    if (message !== '') {\n      setTimeout(() => {\n        if (assertiveness === 'assertive') {\n          setAssertiveMessages(messages => messages.filter(message => message.id !== id));\n        } else {\n          setPoliteMessages(messages => messages.filter(message => message.id !== id));\n        }\n      }, timeout);\n    }\n  };\n\n  useImperativeHandle(ref, () => ({\n    announce,\n    clear\n  }));\n\n  return (\n    <Fragment>\n      <MessageBlock aria-live=\"assertive\">\n        {assertiveMessages.map(message => <div key={message.id}>{message.text}</div>)}\n      </MessageBlock>\n      <MessageBlock aria-live=\"polite\">\n        {politeMessages.map(message => <div key={message.id}>{message.text}</div>)}\n      </MessageBlock>\n    </Fragment>\n  );\n});\n\ninterface MessageBlockProps {\n   children: ReactNode,\n   'aria-live': Assertiveness\n }\n\nfunction MessageBlock({children, 'aria-live': ariaLive}: MessageBlockProps) {\n  return (\n    <VisuallyHidden\n      role=\"log\"\n      aria-live={ariaLive}\n      aria-relevant=\"additions\">\n      {children}\n    </VisuallyHidden>\n  );\n}\n"],"names":[],"version":3,"file":"main.js.map"}